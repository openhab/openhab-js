<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>rules/trigger-builder.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="actions.html">actions</a><ul class='members'><li data-type='member'><a href="actions.html#.Audio">Audio</a></li><li data-type='member'><a href="actions.html#.BusEvent">BusEvent</a></li><li data-type='member'><a href="actions.html#.CoreUtil">CoreUtil</a></li><li data-type='member'><a href="actions.html#.Ephemeris">Ephemeris</a></li><li data-type='member'><a href="actions.html#.Exec">Exec</a></li><li data-type='member'><a href="actions.html#.HTTP">HTTP</a></li><li data-type='member'><a href="actions.html#.Log">Log</a></li><li data-type='member'><a href="actions.html#.NotificationAction">NotificationAction</a></li><li data-type='member'><a href="actions.html#.Ping">Ping</a></li><li data-type='member'><a href="actions.html#.Semantics">Semantics</a></li><li data-type='member'><a href="actions.html#.Things">Things</a></li><li data-type='member'><a href="actions.html#.Voice">Voice</a></li></ul><ul class='methods'><li data-type='method'><a href="actions.html#.get">get</a></li><li data-type='method'><a href="actions.html#.thingActions">thingActions</a></li></ul></li><li><a href="cache.html">cache</a><ul class='members'><li data-type='member'><a href="cache.html#.private">private</a></li><li data-type='member'><a href="cache.html#.shared">shared</a></li></ul></li><li><a href="items.html">items</a><ul class='members'><li data-type='member'><a href="items.html#.DYNAMIC_ITEM_TAG">DYNAMIC_ITEM_TAG</a></li></ul><ul class='methods'><li data-type='method'><a href="items.html#.NAME">NAME</a></li><li data-type='method'><a href="items.html#.addItem">addItem</a></li><li data-type='method'><a href="items.html#.existsItem">existsItem</a></li><li data-type='method'><a href="items.html#.getItem">getItem</a></li><li data-type='method'><a href="items.html#.getItems">getItems</a></li><li data-type='method'><a href="items.html#.getItemsByTag">getItemsByTag</a></li><li data-type='method'><a href="items.html#.removeItem">removeItem</a></li><li data-type='method'><a href="items.html#.replaceItem">replaceItem</a></li><li data-type='method'><a href="items.html#.safeItemName">safeItemName</a></li></ul></li><li><a href="items.metadata.html">metadata</a><ul class='methods'><li data-type='method'><a href="items.metadata.html#.getMetadata">getMetadata</a></li><li data-type='method'><a href="items.metadata.html#.removeMetadata">removeMetadata</a></li><li data-type='method'><a href="items.metadata.html#.replaceMetadata">replaceMetadata</a></li></ul></li><li><a href="items.metadata.itemchannellink.html">itemchannellink</a><ul class='methods'><li data-type='method'><a href="items.metadata.itemchannellink.html#.getItemChannelLink">getItemChannelLink</a></li><li data-type='method'><a href="items.metadata.itemchannellink.html#.removeItemChannelLink">removeItemChannelLink</a></li><li data-type='method'><a href="items.metadata.itemchannellink.html#.removeLinksForItem">removeLinksForItem</a></li><li data-type='method'><a href="items.metadata.itemchannellink.html#.removeOrphanedItemChannelLinks">removeOrphanedItemChannelLinks</a></li><li data-type='method'><a href="items.metadata.itemchannellink.html#.replaceItemChannelLink">replaceItemChannelLink</a></li></ul></li><li><a href="log.html">log</a><ul class='members'><li data-type='member'><a href="log.html#.LOGGER_PREFIX">LOGGER_PREFIX</a></li></ul><ul class='methods'><li data-type='method'><a href="log.html#.newLogger">newLogger</a></li></ul></li><li><a href="osgi.html">osgi</a><ul class='methods'><li data-type='method'><a href="osgi.html#.findServices">findServices</a></li><li data-type='method'><a href="osgi.html#.getService">getService</a></li></ul></li><li><a href="rules.html">rules</a><ul class='methods'><li data-type='method'><a href="rules.html#.JSRule">JSRule</a></li><li data-type='method'><a href="rules.html#.SwitchableJSRule">SwitchableJSRule</a></li><li data-type='method'><a href="rules.html#.isEnabled">isEnabled</a></li><li data-type='method'><a href="rules.html#.removeRule">removeRule</a></li><li data-type='method'><a href="rules.html#.runRule">runRule</a></li><li data-type='method'><a href="rules.html#.setEnabled">setEnabled</a></li><li data-type='method'><a href="rules.html#.when">when</a></li></ul></li><li><a href="things.html">things</a><ul class='methods'><li data-type='method'><a href="things.html#.getThing">getThing</a></li><li data-type='method'><a href="things.html#.getThings">getThings</a></li></ul></li><li><a href="time.html">time</a><ul class='methods'><li data-type='method'><a href="time.html#.toZDT">toZDT</a></li></ul></li><li><a href="triggers.html">triggers</a><ul class='methods'><li data-type='method'><a href="triggers.html#.ChannelEventTrigger">ChannelEventTrigger</a></li><li data-type='method'><a href="triggers.html#.DateTimeTrigger">DateTimeTrigger</a></li><li data-type='method'><a href="triggers.html#.GenericCronTrigger">GenericCronTrigger</a></li><li data-type='method'><a href="triggers.html#.GenericEventTrigger">GenericEventTrigger</a></li><li data-type='method'><a href="triggers.html#.GroupCommandTrigger">GroupCommandTrigger</a></li><li data-type='method'><a href="triggers.html#.GroupStateChangeTrigger">GroupStateChangeTrigger</a></li><li data-type='method'><a href="triggers.html#.GroupStateUpdateTrigger">GroupStateUpdateTrigger</a></li><li data-type='method'><a href="triggers.html#.ItemCommandTrigger">ItemCommandTrigger</a></li><li data-type='method'><a href="triggers.html#.ItemStateChangeTrigger">ItemStateChangeTrigger</a></li><li data-type='method'><a href="triggers.html#.ItemStateUpdateTrigger">ItemStateUpdateTrigger</a></li><li data-type='method'><a href="triggers.html#.PIDTrigger">PIDTrigger</a></li><li data-type='method'><a href="triggers.html#.PWMTrigger">PWMTrigger</a></li><li data-type='method'><a href="triggers.html#.SystemStartlevelTrigger">SystemStartlevelTrigger</a></li><li data-type='method'><a href="triggers.html#.ThingStatusChangeTrigger">ThingStatusChangeTrigger</a></li><li data-type='method'><a href="triggers.html#.ThingStatusUpdateTrigger">ThingStatusUpdateTrigger</a></li><li data-type='method'><a href="triggers.html#.TimeOfDayTrigger">TimeOfDayTrigger</a></li></ul></li><li><a href="utils.html">utils</a><ul class='members'><li data-type='member'><a href="utils.html#.OPENHAB_JS_VERSION">OPENHAB_JS_VERSION</a></li></ul><ul class='methods'><li data-type='method'><a href="utils.html#.dumpObject">dumpObject</a></li><li data-type='method'><a href="utils.html#.isJsInstanceOfJavaType">isJsInstanceOfJavaType</a></li><li data-type='method'><a href="utils.html#.javaInstantToJsInstant">javaInstantToJsInstant</a></li><li data-type='method'><a href="utils.html#.javaListToJsArray">javaListToJsArray</a></li><li data-type='method'><a href="utils.html#.javaMapToJsMap">javaMapToJsMap</a></li><li data-type='method'><a href="utils.html#.javaMapToJsObj">javaMapToJsObj</a></li><li data-type='method'><a href="utils.html#.javaSetToJsArray">javaSetToJsArray</a></li><li data-type='method'><a href="utils.html#.javaSetToJsSet">javaSetToJsSet</a></li><li data-type='method'><a href="utils.html#.javaZDTToJsZDT">javaZDTToJsZDT</a></li><li data-type='method'><a href="utils.html#.javaZDTToJsZDTWithDefaultZoneSystem">javaZDTToJsZDTWithDefaultZoneSystem</a></li><li data-type='method'><a href="utils.html#.jsArrayToJavaList">jsArrayToJavaList</a></li><li data-type='method'><a href="utils.html#.jsArrayToJavaSet">jsArrayToJavaSet</a></li><li data-type='method'><a href="utils.html#.jsSetToJavaSet">jsSetToJavaSet</a></li><li data-type='method'><a href="utils.html#.randomUUID">randomUUID</a></li></ul></li></ul><h3>Classes</h3><ul><li><a href="ConditionBuilder.html">ConditionBuilder</a><ul class='methods'><li data-type='method'><a href="ConditionBuilder.html#stateOfItem">stateOfItem</a></li><li data-type='method'><a href="ConditionBuilder.html#then">then</a></li></ul></li><li><a href="ConditionBuilder.ConditionConf.html">ConditionConf</a><ul class='methods'><li data-type='method'><a href="ConditionBuilder.ConditionConf.html#then">then</a></li></ul></li><li><a href="ConditionBuilder.FunctionConditionConf.html">FunctionConditionConf</a><ul class='methods'><li data-type='method'><a href="ConditionBuilder.FunctionConditionConf.html#then">then</a></li></ul></li><li><a href="ConditionBuilder.ItemStateConditionConf.html">ItemStateConditionConf</a><ul class='methods'><li data-type='method'><a href="ConditionBuilder.ItemStateConditionConf.html#in">in</a></li><li data-type='method'><a href="ConditionBuilder.ItemStateConditionConf.html#is">is</a></li><li data-type='method'><a href="ConditionBuilder.ItemStateConditionConf.html#then">then</a></li></ul></li><li><a href="JSCache.html">JSCache</a><ul class='methods'><li data-type='method'><a href="JSCache.html#exists">exists</a></li><li data-type='method'><a href="JSCache.html#get">get</a></li><li data-type='method'><a href="JSCache.html#put">put</a></li><li data-type='method'><a href="JSCache.html#remove">remove</a></li></ul></li><li><a href="OperationBuilder.html">OperationBuilder</a><ul class='methods'><li data-type='method'><a href="OperationBuilder.html#build">build</a></li><li data-type='method'><a href="OperationBuilder.html#copyAndSendState">copyAndSendState</a></li><li data-type='method'><a href="OperationBuilder.html#copyState">copyState</a></li><li data-type='method'><a href="OperationBuilder.html#inGroup">inGroup</a></li><li data-type='method'><a href="OperationBuilder.html#postIt">postIt</a></li><li data-type='method'><a href="OperationBuilder.html#postUpdate">postUpdate</a></li><li data-type='method'><a href="OperationBuilder.html#send">send</a></li><li data-type='method'><a href="OperationBuilder.html#sendIt">sendIt</a></li><li data-type='method'><a href="OperationBuilder.html#sendOff">sendOff</a></li><li data-type='method'><a href="OperationBuilder.html#sendOn">sendOn</a></li><li data-type='method'><a href="OperationBuilder.html#sendToggle">sendToggle</a></li></ul></li><li><a href="OperationBuilder.CopyStateOperation.html">CopyStateOperation</a><ul class='methods'><li data-type='method'><a href="OperationBuilder.CopyStateOperation.html#and">and</a></li><li data-type='method'><a href="OperationBuilder.CopyStateOperation.html#fromItem">fromItem</a></li><li data-type='method'><a href="OperationBuilder.CopyStateOperation.html#toItem">toItem</a></li></ul></li><li><a href="OperationBuilder.OperationConfig.html">OperationConfig</a><ul class='methods'><li data-type='method'><a href="OperationBuilder.OperationConfig.html#build">build</a></li><li data-type='method'><a href="OperationBuilder.OperationConfig.html#inGroup">inGroup</a></li></ul></li><li><a href="OperationBuilder.SendCommandOrUpdateOperation.html">SendCommandOrUpdateOperation</a><ul class='methods'><li data-type='method'><a href="OperationBuilder.SendCommandOrUpdateOperation.html#and">and</a></li><li data-type='method'><a href="OperationBuilder.SendCommandOrUpdateOperation.html#toItem">toItem</a></li><li data-type='method'><a href="OperationBuilder.SendCommandOrUpdateOperation.html#toItems">toItems</a></li></ul></li><li><a href="OperationBuilder.TimingItemStateOperation.html">TimingItemStateOperation</a></li><li><a href="OperationBuilder.ToggleOperation.html">ToggleOperation</a><ul class='methods'><li data-type='method'><a href="OperationBuilder.ToggleOperation.html#and">and</a></li><li data-type='method'><a href="OperationBuilder.ToggleOperation.html#doToggle">doToggle</a></li><li data-type='method'><a href="OperationBuilder.ToggleOperation.html#toItem">toItem</a></li></ul></li><li><a href="Quantity.html">Quantity</a><ul class='methods'><li data-type='method'><a href="Quantity.html#add">add</a></li><li data-type='method'><a href="Quantity.html#divide">divide</a></li><li data-type='method'><a href="Quantity.html#equal">equal</a></li><li data-type='method'><a href="Quantity.html#greaterThan">greaterThan</a></li><li data-type='method'><a href="Quantity.html#greaterThanOrEqual">greaterThanOrEqual</a></li><li data-type='method'><a href="Quantity.html#lessThan">lessThan</a></li><li data-type='method'><a href="Quantity.html#lessThanOrEqual">lessThanOrEqual</a></li><li data-type='method'><a href="Quantity.html#multiply">multiply</a></li><li data-type='method'><a href="Quantity.html#subtract">subtract</a></li><li data-type='method'><a href="Quantity.html#toUnit">toUnit</a></li></ul></li><li><a href="QuantityError.html">QuantityError</a></li><li><a href="RuleBuilder.html">RuleBuilder</a><ul class='methods'><li data-type='method'><a href="RuleBuilder.html#when">when</a></li></ul></li><li><a href="TriggerBuilder.html">TriggerBuilder</a><ul class='methods'><li data-type='method'><a href="TriggerBuilder.html#channel">channel</a></li><li data-type='method'><a href="TriggerBuilder.html#cron">cron</a></li><li data-type='method'><a href="TriggerBuilder.html#dateTime">dateTime</a></li><li data-type='method'><a href="TriggerBuilder.html#item">item</a></li><li data-type='method'><a href="TriggerBuilder.html#memberOf">memberOf</a></li><li data-type='method'><a href="TriggerBuilder.html#system">system</a></li><li data-type='method'><a href="TriggerBuilder.html#thing">thing</a></li><li data-type='method'><a href="TriggerBuilder.html#timeOfDay">timeOfDay</a></li></ul></li><li><a href="TriggerBuilder.ChannelTriggerConfig.html">ChannelTriggerConfig</a><ul class='methods'><li data-type='method'><a href="TriggerBuilder.ChannelTriggerConfig.html#to">to</a></li><li data-type='method'><a href="TriggerBuilder.ChannelTriggerConfig.html#triggered">triggered</a></li></ul></li><li><a href="TriggerBuilder.CronTriggerConfig.html">CronTriggerConfig</a></li><li><a href="TriggerBuilder.DateTimeTriggerConfig.html">DateTimeTriggerConfig</a><ul class='methods'><li data-type='method'><a href="TriggerBuilder.DateTimeTriggerConfig.html#timeOnly">timeOnly</a></li></ul></li><li><a href="TriggerBuilder.ItemTriggerConfig.html">ItemTriggerConfig</a><ul class='methods'><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#changed">changed</a></li><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#for">for</a></li><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#from">from</a></li><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#fromOff">fromOff</a></li><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#fromOn">fromOn</a></li><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#receivedCommand">receivedCommand</a></li><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#receivedUpdate">receivedUpdate</a></li><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#to">to</a></li><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#toOff">toOff</a></li><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#toOn">toOn</a></li></ul></li><li><a href="TriggerBuilder.SystemTriggerConfig.html">SystemTriggerConfig</a><ul class='methods'><li data-type='method'><a href="TriggerBuilder.SystemTriggerConfig.html#ruleEngineStarted">ruleEngineStarted</a></li><li data-type='method'><a href="TriggerBuilder.SystemTriggerConfig.html#rulesLoaded">rulesLoaded</a></li><li data-type='method'><a href="TriggerBuilder.SystemTriggerConfig.html#startLevel">startLevel</a></li><li data-type='method'><a href="TriggerBuilder.SystemTriggerConfig.html#startupComplete">startupComplete</a></li><li data-type='method'><a href="TriggerBuilder.SystemTriggerConfig.html#thingsInitialized">thingsInitialized</a></li><li data-type='method'><a href="TriggerBuilder.SystemTriggerConfig.html#userInterfacesStarted">userInterfacesStarted</a></li></ul></li><li><a href="TriggerBuilder.ThingTriggerConfig.html">ThingTriggerConfig</a><ul class='methods'><li data-type='method'><a href="TriggerBuilder.ThingTriggerConfig.html#changed">changed</a></li><li data-type='method'><a href="TriggerBuilder.ThingTriggerConfig.html#from">from</a></li><li data-type='method'><a href="TriggerBuilder.ThingTriggerConfig.html#to">to</a></li><li data-type='method'><a href="TriggerBuilder.ThingTriggerConfig.html#updated">updated</a></li></ul></li><li><a href="TriggerBuilder.TimeOfDayTriggerConfig.html">TimeOfDayTriggerConfig</a></li><li><a href="TriggerBuilder.TriggerConf.html">TriggerConf</a><ul class='methods'><li data-type='method'><a href="TriggerBuilder.TriggerConf.html#if">if</a></li><li data-type='method'><a href="TriggerBuilder.TriggerConf.html#or">or</a></li><li data-type='method'><a href="TriggerBuilder.TriggerConf.html#then">then</a></li></ul></li><li><a href="actions.ScriptExecution.html">ScriptExecution</a><ul class='methods'><li data-type='method'><a href="actions.ScriptExecution.html#.callScript">callScript</a></li><li data-type='method'><a href="actions.ScriptExecution.html#.createTimer">createTimer</a></li></ul></li><li><a href="actions.Transformation.html">Transformation</a><ul class='methods'><li data-type='method'><a href="actions.Transformation.html#.transform">transform</a></li><li data-type='method'><a href="actions.Transformation.html#.transformRaw">transformRaw</a></li></ul></li><li><a href="items.Item.html">Item</a><ul class='methods'><li data-type='method'><a href="items.Item.html#addGroups">addGroups</a></li><li data-type='method'><a href="items.Item.html#addTags">addTags</a></li><li data-type='method'><a href="items.Item.html#getMetadata">getMetadata</a></li><li data-type='method'><a href="items.Item.html#getToggleState">getToggleState</a></li><li data-type='method'><a href="items.Item.html#postToggleUpdate">postToggleUpdate</a></li><li data-type='method'><a href="items.Item.html#postUpdate">postUpdate</a></li><li data-type='method'><a href="items.Item.html#removeGroups">removeGroups</a></li><li data-type='method'><a href="items.Item.html#removeMetadata">removeMetadata</a></li><li data-type='method'><a href="items.Item.html#removeTags">removeTags</a></li><li data-type='method'><a href="items.Item.html#replaceMetadata">replaceMetadata</a></li><li data-type='method'><a href="items.Item.html#sendCommand">sendCommand</a></li><li data-type='method'><a href="items.Item.html#sendCommandIfDifferent">sendCommandIfDifferent</a></li><li data-type='method'><a href="items.Item.html#sendToggleCommand">sendToggleCommand</a></li></ul></li><li><a href="items.ItemPersistence.html">ItemPersistence</a><ul class='methods'><li data-type='method'><a href="items.ItemPersistence.html"></a></li><li data-type='method'><a href="items.ItemPersistence.html"></a></li><li data-type='method'><a href="items.ItemPersistence.html"></a></li><li data-type='method'><a href="items.ItemPersistence.html#averageBetween">averageBetween</a></li><li data-type='method'><a href="items.ItemPersistence.html#averageSince">averageSince</a></li><li data-type='method'><a href="items.ItemPersistence.html#averageUntil">averageUntil</a></li><li data-type='method'><a href="items.ItemPersistence.html#changedBetween">changedBetween</a></li><li data-type='method'><a href="items.ItemPersistence.html#changedSince">changedSince</a></li><li data-type='method'><a href="items.ItemPersistence.html#changedUntil">changedUntil</a></li><li data-type='method'><a href="items.ItemPersistence.html#countBetween">countBetween</a></li><li data-type='method'><a href="items.ItemPersistence.html#countSince">countSince</a></li><li data-type='method'><a href="items.ItemPersistence.html#countStateChangesBetween">countStateChangesBetween</a></li><li data-type='method'><a href="items.ItemPersistence.html#countStateChangesSince">countStateChangesSince</a></li><li data-type='method'><a href="items.ItemPersistence.html#countStateChangesUntil">countStateChangesUntil</a></li><li data-type='method'><a href="items.ItemPersistence.html#countUntil">countUntil</a></li><li data-type='method'><a href="items.ItemPersistence.html#deltaBetween">deltaBetween</a></li><li data-type='method'><a href="items.ItemPersistence.html#deltaSince">deltaSince</a></li><li data-type='method'><a href="items.ItemPersistence.html#deltaUntil">deltaUntil</a></li><li data-type='method'><a href="items.ItemPersistence.html#deviationBetween">deviationBetween</a></li><li data-type='method'><a href="items.ItemPersistence.html#deviationSince">deviationSince</a></li><li data-type='method'><a href="items.ItemPersistence.html#deviationUntil">deviationUntil</a></li><li data-type='method'><a href="items.ItemPersistence.html#evolutionRateBetween">evolutionRateBetween</a></li><li data-type='method'><a href="items.ItemPersistence.html#evolutionRateSince">evolutionRateSince</a></li><li data-type='method'><a href="items.ItemPersistence.html#evolutionRateUntil">evolutionRateUntil</a></li><li data-type='method'><a href="items.ItemPersistence.html#getAllStatesBetween">getAllStatesBetween</a></li><li data-type='method'><a href="items.ItemPersistence.html#getAllStatesSince">getAllStatesSince</a></li><li data-type='method'><a href="items.ItemPersistence.html#getAllStatesUntil">getAllStatesUntil</a></li><li data-type='method'><a href="items.ItemPersistence.html#lastUpdate">lastUpdate</a></li><li data-type='method'><a href="items.ItemPersistence.html#maximumBetween">maximumBetween</a></li><li data-type='method'><a href="items.ItemPersistence.html#maximumSince">maximumSince</a></li><li data-type='method'><a href="items.ItemPersistence.html#maximumUntil">maximumUntil</a></li><li data-type='method'><a href="items.ItemPersistence.html#minimumBetween">minimumBetween</a></li><li data-type='method'><a href="items.ItemPersistence.html#minimumSince">minimumSince</a></li><li data-type='method'><a href="items.ItemPersistence.html#minimumUntil">minimumUntil</a></li><li data-type='method'><a href="items.ItemPersistence.html#nextState">nextState</a></li><li data-type='method'><a href="items.ItemPersistence.html#nextUpdate">nextUpdate</a></li><li data-type='method'><a href="items.ItemPersistence.html#persist">persist</a></li><li data-type='method'><a href="items.ItemPersistence.html#persistedState">persistedState</a></li><li data-type='method'><a href="items.ItemPersistence.html#previousState">previousState</a></li><li data-type='method'><a href="items.ItemPersistence.html#removeAllStatesBetween">removeAllStatesBetween</a></li><li data-type='method'><a href="items.ItemPersistence.html#removeAllStatesSince">removeAllStatesSince</a></li><li data-type='method'><a href="items.ItemPersistence.html#removeAllStatesUntil">removeAllStatesUntil</a></li><li data-type='method'><a href="items.ItemPersistence.html#sumBetween">sumBetween</a></li><li data-type='method'><a href="items.ItemPersistence.html#sumSince">sumSince</a></li><li data-type='method'><a href="items.ItemPersistence.html#sumUntil">sumUntil</a></li><li data-type='method'><a href="items.ItemPersistence.html#updatedBetween">updatedBetween</a></li><li data-type='method'><a href="items.ItemPersistence.html#updatedSince">updatedSince</a></li><li data-type='method'><a href="items.ItemPersistence.html#updatedUntil">updatedUntil</a></li><li data-type='method'><a href="items.ItemPersistence.html#varianceBetween">varianceBetween</a></li><li data-type='method'><a href="items.ItemPersistence.html#varianceSince">varianceSince</a></li><li data-type='method'><a href="items.ItemPersistence.html#varianceUntil">varianceUntil</a></li></ul></li><li><a href="items.ItemSemantics.html">ItemSemantics</a></li><li><a href="items.PersistedItem.html">PersistedItem</a></li><li><a href="items.PersistedState.html">PersistedState</a></li><li><a href="items.TimeSeries.html">TimeSeries</a><ul class='methods'><li data-type='method'><a href="items.TimeSeries.html#add">add</a></li></ul></li><li><a href="items.metadata.ItemMetadata.html">ItemMetadata</a></li><li><a href="log.Logger.html">Logger</a><ul class='methods'><li data-type='method'><a href="log.Logger.html#atLevel">atLevel</a></li><li data-type='method'><a href="log.Logger.html#debug">debug</a></li><li data-type='method'><a href="log.Logger.html#error">error</a></li><li data-type='method'><a href="log.Logger.html#info">info</a></li><li data-type='method'><a href="log.Logger.html#trace">trace</a></li><li data-type='method'><a href="log.Logger.html#warn">warn</a></li></ul></li><li><a href="things.Thing.html">Thing</a><ul class='methods'><li data-type='method'><a href="things.Thing.html#setEnabled">setEnabled</a></li><li data-type='method'><a href="things.Thing.html#setLabel">setLabel</a></li><li data-type='method'><a href="things.Thing.html#setLocation">setLocation</a></li><li data-type='method'><a href="things.Thing.html#setProperty">setProperty</a></li></ul></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">rules/trigger-builder.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const triggers = require('../triggers');
const operations = require('./operation-builder');
const conditions = require('./condition-builder');

/**
 * Builder for rule Triggers
 *
 * @hideconstructor
 */
class TriggerBuilder {
  constructor (builder) {
    /** @private */
    this._builder = builder;
  }

  /** @private */
  _setTrigger (trigger) {
    this.currentTrigger = trigger;
    return this.currentTrigger;
  }

  /** @private */
  _or () {
    this._builder.addTrigger(this.currentTrigger);
    return this;
  }

  /** @private */
  _then (fn) {
    this._or();
    return new operations.OperationBuilder(this._builder, fn);
  }

  /** @private */
  _if (fn) {
    this._or();
    return new conditions.ConditionBuilder(this._builder, fn);
  }

  /**
   * Specifies a channel event as a source for the rule to fire.
   *
   * @param {string} channelName the name of the channel
   * @returns {ChannelTriggerConfig} the trigger config
   */
  channel (channelName) {
    return this._setTrigger(new ChannelTriggerConfig(channelName, this));
  }

  /**
   * Specifies a cron schedule for the rule to fire.
   *
   * @param {string} cronExpression the cron expression
   * @returns {CronTriggerConfig} the trigger config
   */
  cron (cronExpression) {
    return this._setTrigger(new CronTriggerConfig(cronExpression, this));
  }

  /**
   * Specifies a time schedule for the rule to fire.
   *
   * @param {string} time the time expression (in `HH:mm`) defining the triggering schedule
   * @returns {TimeOfDayTriggerConfig} the trigger config
   */
  timeOfDay (time) {
    return this._setTrigger(new TimeOfDayTriggerConfig(time, this));
  }

  /**
   * Specifies an Item as the source of changes to trigger a rule.
   *
   * @param {string} itemName the name of the Item
   * @returns {ItemTriggerConfig} the trigger config
   */
  item (itemName) {
    return this._setTrigger(new ItemTriggerConfig(itemName, false, this));
  }

  /**
   * Specifies a group member as the source of changes to trigger a rule.
   *
   * @param {string} groupName the name of the group
   * @returns {ItemTriggerConfig} the trigger config
   */
  memberOf (groupName) {
    return this._setTrigger(new ItemTriggerConfig(groupName, true, this));
  }

  /**
   * Specifies a Thing status event as a source for the rule to fire.
   *
   * @param {string} thingUID the UID of the Thing
   * @returns {ThingTriggerConfig} the trigger config
   */
  thing (thingUID) {
    return this._setTrigger(new ThingTriggerConfig(thingUID, this));
  }

  /**
   * Specifies a system event as a source for the rule to fire.
   *
   * @memberof TriggerBuilder
   * @returns {SystemTriggerConfig} the trigger config
   */
  system () {
    return this._setTrigger(new SystemTriggerConfig(this));
  }

  /**
   * Specifies a DateTime Item whose (optional) date and time schedule the rule to fire.
   *
   * @param {string} itemName the name of the Item to monitor for change
   * @returns {DateTimeTriggerConfig} the trigger config
   */
  dateTime (itemName) {
    return this._setTrigger(new DateTimeTriggerConfig(itemName, this));
  }
}

/**
 * {RuleBuilder} RuleBuilder triggers
 * @memberof TriggerBuilder
 */
class TriggerConf {
  constructor (triggerBuilder) {
    /** @private */
    this.triggerBuilder = triggerBuilder;
  }

  /**
   * Add an additional Trigger
   *
   * @returns {TriggerBuilder}
   */
  or () {
    return this.triggerBuilder._or();
  }

  /**
   * Move to the rule operations
   *
   * @param {*} fn the optional function to execute
   * @returns {operations.OperationBuilder}
   */
  then (fn) {
    return this.triggerBuilder._then(fn);
  }

  /**
   * Move to the rule condition
   *
   * @param {*} fn the optional function to execute
   * @returns {conditions.ConditionBuilder}
   */
  if (fn) {
    return this.triggerBuilder._if(fn);
  }
}

/**
 * @memberof TriggerBuilder
 * @extends TriggerConf
 * @hideconstructor
 */
class ChannelTriggerConfig extends TriggerConf {
  constructor (channelName, triggerBuilder) {
    super(triggerBuilder);
    this.channelName = channelName;
    this._toOHTriggers = () => [triggers.ChannelEventTrigger(this.channelName, this.eventName)];
  }

  /** @private */
  describe (compact) {
    if (compact) {
      return this.channelName + (this.eventName ? `:${this.eventName}` : '');
    } else {
      return `matches channel "${this.channelName}"` + (this.eventName ? `for event ${this.eventName}` : '');
    }
  }

  /**
   * trigger a specific event name
   *
   * @param {string} eventName
   * @returns {ChannelTriggerConfig}
   */
  to (eventName) {
    return this.triggered(eventName);
  }

  /**
   * trigger a specific event name
   *
   * @param {string} eventName
   * @returns {ChannelTriggerConfig}
   */
  triggered (eventName) {
    this.eventName = eventName || '';
    return this;
  }

  /** @private */
  _complete () {
    return typeof (this.eventName) !== 'undefined';
  }
}

/**
 * Cron based trigger
 *
 * @memberof TriggerBuilder
 * @extends TriggerConf
 * @hideconstructor
 */
class CronTriggerConfig extends TriggerConf {
  constructor (timeStr, triggerBuilder) {
    super(triggerBuilder);
    /** @private */
    this.timeStr = timeStr;
    /** @private */
    this._complete = () => true;
    /** @private */
    this._toOHTriggers = () => [triggers.GenericCronTrigger(this.timeStr)];
    /** @private */
    this.describe = (compact) => compact ? `cron_${this.timeStr}` : `matches cron "${this.timeStr}"`;
  }
}

/**
 * Time of day based trigger
 *
 * @memberof TriggerBuilder
 * @extends TriggerConf
 * @hideconstructor
 */
class TimeOfDayTriggerConfig extends TriggerConf {
  constructor (timeStr, triggerBuilder) {
    super(triggerBuilder);
    /** @private */
    this.timeStr = timeStr;
    /** @private */
    this._complete = () => true;
    /** @private */
    this._toOHTriggers = () => [triggers.TimeOfDayTrigger(this.timeStr)];
    /** @private */
    this.describe = (compact) => compact ? `timeOfDay_${this.timeStr}` : `matches time of day "${this.timeStr}"`;
  }
}

/**
 * Item based trigger
 *
 * @memberof TriggerBuilder
 * @extends TriggerConf
 * @hideconstructor
 */
class ItemTriggerConfig extends TriggerConf {
  constructor (itemOrName, isGroup, triggerBuilder) {
    super(triggerBuilder);
    this.type = isGroup ? 'memberOf' : 'Item';
    if (typeof itemOrName !== 'string') {
      itemOrName = itemOrName.name;
    }

    /** @private */
    this.item_name = itemOrName;
    /** @private */
    this.describe = () => `${this.type} ${this.item_name} changed`;
    this.of = this.to; // receivedCommand().of(..)
  }

  /**
   * Item to
   *
   * @param {*} value this Item should be triggered to
   * @returns {ItemTriggerConfig}
   */
  to (value) {
    this.to_value = value;
    return this;
  }

  /**
   * Item from
   * @param {*} value this items should be triggered from
   * @returns {ItemTriggerConfig}
   */
  from (value) {
    if (this.op_type !== 'changed') {
      throw Error('.from(..) only available for .changed()');
    }
    this.from_value = value;
    return this;
  }

  /**
   * Item changed to OFF
   *
   * @returns {ItemTriggerConfig}
   */
  toOff () {
    return this.to('OFF');
  }

  /**
   * Item changed to ON
   *
   * @returns {ItemTriggerConfig}
   */
  toOn () {
    return this.to('ON');
  }

  /**
   * Item changed from OFF
   *
   * @returns {ItemTriggerConfig}
   */
  fromOff () {
    return this.from('OFF');
  }

  /**
   * Item changed from ON
   *
   * @returns {ItemTriggerConfig}
   */
  fromOn () {
    return this.from('ON');
  }

  /**
   * Item received command
   *
   * @returns {ItemTriggerConfig}
   */
  receivedCommand () {
    this.op_type = 'receivedCommand';
    return this;
  }

  /**
   * Item received update
   *
   * @returns {ItemTriggerConfig}
   */
  receivedUpdate () {
    this.op_type = 'receivedUpdate';
    return this;
  }

  /**
   * Item changed state
   *
   * @returns {ItemTriggerConfig}
   */
  changed () {
    this.op_type = 'changed';
    return this;
  }

  /**
   * For timespan
   * @param {*} timespan
   * @returns {ItemTriggerConfig}
   */
  for (timespan) {
    return new operations.TimingItemStateOperation(this, timespan);
  }

  /** @private */
  _complete () {
    return typeof (this.op_type) !== 'undefined';
  }

  /** @private */
  describe (compact) {
    switch (this.op_type) {
      case 'changed':
        if (compact) {
          let transition = this.from_value + '=>' || '';
          if (this.to_value) {
            transition = (transition || '=>') + this.to_value;
          }

          return `${this.item_name} ${transition}/Δ`;
        } else {
          let transition = 'changed';
          if (this.from_value) {
            transition += ` from ${this.from_value}`;
          }

          if (this.to_value) {
            transition += ` to ${this.to_value}`;
          }

          return `${this.item_name} ${transition}`;
        }
      case 'receivedCommand':
        return compact ? `${this.item_name}/⌘` : `${this.type} ${this.item_name} received command`;
      case 'receivedUpdate':
        return compact ? `${this.item_name}/↻` : `${this.type} ${this.item_name} received update`;
      default:
        throw Error('Unknown operation type: ' + this.op_type);
    }
  }

  /** @private */
  _toOHTriggers () {
    if (this.type === 'memberOf') {
      switch (this.op_type) {
        case 'changed':
          return [triggers.GroupStateChangeTrigger(this.item_name, this.from_value, this.to_value)];
        case 'receivedCommand':
          return [triggers.GroupCommandTrigger(this.item_name, this.to_value)];
        case 'receivedUpdate':
          return [triggers.GroupStateUpdateTrigger(this.item_name, this.to_value)];
        default:
          throw Error('Unknown operation type: ' + this.op_type);
      }
    } else {
      switch (this.op_type) {
        case 'changed':
          return [triggers.ItemStateChangeTrigger(this.item_name, this.from_value, this.to_value)];
        case 'receivedCommand':
          return [triggers.ItemCommandTrigger(this.item_name, this.to_value)];
        case 'receivedUpdate':
          return [triggers.ItemStateUpdateTrigger(this.item_name, this.to_value)];
        default:
          throw Error('Unknown operation type: ' + this.op_type);
      }
    }
  }

  /** @private */
  _executeHook () {
    const getReceivedCommand = (args) => args.receivedCommand;

    if (this.op_type === 'receivedCommand') { // add the received command as 'it'
      return function (next, args) {
        const it = getReceivedCommand(args);
        return next({
          ...args,
          it
        });
      };
    } else {
      return null;
    }
  }
}

/**
 * Thing based trigger
 *
 * @memberof TriggerBuilder
 * @extends TriggerConf
 * @hideconstructor
 */
class ThingTriggerConfig extends TriggerConf {
  constructor (thingUID, triggerBuilder) {
    super(triggerBuilder);
    /** @private */
    this.thingUID = thingUID;
  }

  /** @private */
  _complete () {
    return typeof (this.op_type) !== 'undefined';
  }

  /** @private */
  describe (compact) {
    switch (this.op_type) {
      case 'changed':
        let transition = 'changed'; // eslint-disable-line no-case-declarations

        if (this.to_value) {
          transition += ` to ${this.to_value}`;
        }

        if (this.from_value) {
          transition += ` from ${this.from_value}`;
        }

        return `${this.thingUID} ${transition}`;
      case 'updated':
        return compact ? `${this.thingUID}/updated` : `Thing ${this.thingUID} received update`;
      default:
        throw Error('Unknown operation type: ' + this.op_type);
    }
  }

  /**
   * thing changed
   *
   * @returns {ThingTriggerConfig}
   */
  changed () {
    this.op_type = 'changed';
    return this;
  }

  /**
   * thing updates
   *
   * @returns {ThingTriggerConfig}
   */
  updated () {
    this.op_type = 'updated';
    return this;
  }

  /**
   * thing status changed from
   *
   * @returns {ThingTriggerConfig}
   */
  from (value) {
    if (this.op_type !== 'changed') {
      throw Error('.from(..) only available for .changed()');
    }
    this.from_value = value;
    return this;
  }

  /**
   * thing status changed to
   *
   * @returns {ThingTriggerConfig}
   */
  to (value) {
    this.to_value = value;
    return this;
  }

  /** @private */
  _toOHTriggers () {
    switch (this.op_type) {
      case 'changed':
        return [triggers.ThingStatusChangeTrigger(this.thingUID, this.to_value, this.from_value)];
      case 'updated':
        return [triggers.ThingStatusUpdateTrigger(this.thingUID, this.to_value)];
      default:
        throw Error('Unknown operation type: ' + this.op_type);
    }
  }
}

/**
 * System based trigger
 *
 * @memberof TriggerBuilder
 * @extends TriggerConf
 * @hideconstructor
 */
class SystemTriggerConfig extends TriggerConf {
  constructor (triggerBuilder) {
    super(triggerBuilder);
    this._toOHTriggers = () => [triggers.SystemStartlevelTrigger(this.level)];
    this.describe = (compact) => compact ? `system:${this.level}` : `system level "${this.level}"`;
  }

  /** @private */
  _complete () {
    return typeof (this.level) !== 'undefined';
  }

  /**
   * System trigger
   *
   * @returns {SystemTriggerConfig}
   */
  rulesLoaded () {
    return this.startLevel(40);
  }

  /**
   * System trigger
   *
   * @returns {SystemTriggerConfig}
   */
  ruleEngineStarted () {
    return this.startLevel(50);
  }

  /**
   * System trigger
   *
   * @returns {SystemTriggerConfig}
   */
  userInterfacesStarted () {
    return this.startLevel(70);
  }

  /**
   * System trigger
   *
   * @returns {SystemTriggerConfig}
   */
  thingsInitialized () {
    return this.startLevel(80);
  }

  /**
   * System trigger
   *
   * @returns {SystemTriggerConfig}
   */
  startupComplete () {
    return this.startLevel(100);
  }

  /**
   * System trigger
   *
   * @param {number} level
   * @returns {SystemTriggerConfig}
   */
  startLevel (level) {
    if (typeof (this.level) !== 'undefined') {
      throw Error('Level already set');
    }
    this.level = level;
    return this;
  }
}

/**
 * DateTime Item based trigger
 *
 * @memberof TriggerBuilder
 * @extends TriggerConf
 * @hideconstructor
 */
class DateTimeTriggerConfig extends TriggerConf {
  constructor (itemName, triggerBuilder) {
    super(triggerBuilder);
    /** @private */
    this._itemName = itemName;
    /** @private */
    this._timeOnly = false;
    /** @private */
    this._complete = () => true;
    /** @private */
    this._toOHTriggers = () => [triggers.DateTimeTrigger(this._itemName, this._timeOnly)];
    /** @private */
    this.describe = (compact) => compact ? `dateTime_${this._itemName}` : `matches ${this._timeOnly ? 'time' : 'date and time'} of Item "${this._itemName}"`;
  }

  /**
   * Specifies whether only the time of the Item should be compared or the date and time.
   *
   * @param {boolean} [timeOnly=true]
   * @returns {DateTimeTriggerConfig}
   */
  timeOnly (timeOnly = true) {
    this._timeOnly = timeOnly;
    return this;
  }
}

module.exports = {
  CronTriggerConfig,
  ChannelTriggerConfig,
  ItemTriggerConfig,
  ThingTriggerConfig,
  SystemTriggerConfig,
  TriggerBuilder
};
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.2</a> on Sat Jun 08 2024 15:20:34 GMT+0000 (Coordinated Universal Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>



</body>
</html>
