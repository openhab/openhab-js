<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>Home - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="actions.html">actions</a><ul class='members'><li data-type='member'><a href="actions.html#.Audio">Audio</a></li><li data-type='member'><a href="actions.html#.BusEvent">BusEvent</a></li><li data-type='member'><a href="actions.html#.Ephemeris">Ephemeris</a></li><li data-type='member'><a href="actions.html#.Exec">Exec</a></li><li data-type='member'><a href="actions.html#.HTTP">HTTP</a></li><li data-type='member'><a href="actions.html#.Log">Log</a></li><li data-type='member'><a href="actions.html#.Ping">Ping</a></li><li data-type='member'><a href="actions.html#.ScriptExecution">ScriptExecution</a></li><li data-type='member'><a href="actions.html#.Semantics">Semantics</a></li><li data-type='member'><a href="actions.html#.Things">Things</a></li><li data-type='member'><a href="actions.html#.Voice">Voice</a></li></ul></li><li><a href="cache.html">cache</a><ul class='methods'><li data-type='method'><a href="cache.html#.get">get</a></li><li data-type='method'><a href="cache.html#.put">put</a></li><li data-type='method'><a href="cache.html#.remove">remove</a></li><li data-type='method'><a href="cache.html#.exists">exists</a></li></ul></li><li><a href="items.html">items</a><ul class='methods'><li data-type='method'><a href="items.html#.createItem">createItem</a></li><li data-type='method'><a href="items.html#.addItem">addItem</a></li><li data-type='method'><a href="items.html#.removeItem">removeItem</a></li><li data-type='method'><a href="items.html#.replaceItem">replaceItem</a></li><li data-type='method'><a href="items.html#.getItem">getItem</a></li><li data-type='method'><a href="items.html#.getItems">getItems</a></li><li data-type='method'><a href="items.html#.getItemsByTag">getItemsByTag</a></li><li data-type='method'><a href="items.html#.safeItemName">safeItemName</a></li></ul></li><li></li><li><a href="global.html#log">log</a><ul class='members'><li data-type='member'><a href="log.html#.default">default</a></li></ul></li><li><a href="rules.html">rules</a><ul class='methods'><li data-type='method'><a href="rules.html#.when">when</a></li><li data-type='method'><a href="rules.html#.removeRule">removeRule</a></li><li data-type='method'><a href="rules.html#.runRule">runRule</a></li><li data-type='method'><a href="rules.html#.JSRule">JSRule</a></li><li data-type='method'><a href="rules.html#.SwitchableJSRule">SwitchableJSRule</a></li></ul></li><li><a href="time.html">time</a></li><li><a href="triggers.html">triggers</a><ul class='members'><li data-type='member'><a href="triggers.html#.ChannelEventTrigger">ChannelEventTrigger</a></li><li data-type='member'><a href="triggers.html#.ItemStateChangeTrigger">ItemStateChangeTrigger</a></li><li data-type='member'><a href="triggers.html#.ItemStateUpdateTrigger">ItemStateUpdateTrigger</a></li><li data-type='member'><a href="triggers.html#.ItemCommandTrigger">ItemCommandTrigger</a></li><li data-type='member'><a href="triggers.html#.GroupStateChangeTrigger">GroupStateChangeTrigger</a></li><li data-type='member'><a href="triggers.html#.GroupStateUpdateTrigger">GroupStateUpdateTrigger</a></li><li data-type='member'><a href="triggers.html#.GroupCommandTrigger">GroupCommandTrigger</a></li><li data-type='member'><a href="triggers.html#.ThingStatusUpdateTrigger">ThingStatusUpdateTrigger</a></li><li data-type='member'><a href="triggers.html#.ThingStatusChangeTrigger">ThingStatusChangeTrigger</a></li><li data-type='member'><a href="triggers.html#.SystemStartlevelTrigger">SystemStartlevelTrigger</a></li><li data-type='member'><a href="triggers.html#.GenericCronTrigger">GenericCronTrigger</a></li><li data-type='member'><a href="triggers.html#.TimeOfDayTrigger">TimeOfDayTrigger</a></li></ul></li><li><a href="utils.html">utils</a><ul class='methods'><li data-type='method'><a href="utils.html#.jsSetToJavaSet">jsSetToJavaSet</a></li><li data-type='method'><a href="utils.html#.jsArrayToJavaSet">jsArrayToJavaSet</a></li><li data-type='method'><a href="utils.html#.jsArrayToJavaList">jsArrayToJavaList</a></li><li data-type='method'><a href="utils.html#.javaListToJsArray">javaListToJsArray</a></li><li data-type='method'><a href="utils.html#.javaSetToJsArray">javaSetToJsArray</a></li><li data-type='method'><a href="utils.html#.javaSetToJsSet">javaSetToJsSet</a></li><li data-type='method'><a href="utils.html#.randomUUID">randomUUID</a></li><li data-type='method'><a href="utils.html#.dumpObject">dumpObject</a></li><li data-type='method'><a href="utils.html#.isJsInstanceOfJava">isJsInstanceOfJava</a></li></ul></li></ul><h3>Classes</h3><ul><li><a href="items.ItemHistory.html">ItemHistory</a><ul class='methods'><li data-type='method'><a href="items.ItemHistory.html#averageSince">averageSince</a></li><li data-type='method'><a href="items.ItemHistory.html#changedSince">changedSince</a></li><li data-type='method'><a href="items.ItemHistory.html#deltaSince">deltaSince</a></li><li data-type='method'><a href="items.ItemHistory.html#deviationSince">deviationSince</a></li><li data-type='method'><a href="items.ItemHistory.html#evolutionRate">evolutionRate</a></li><li data-type='method'><a href="items.ItemHistory.html#historicState">historicState</a></li><li data-type='method'><a href="items.ItemHistory.html#lastUpdate">lastUpdate</a></li><li data-type='method'><a href="items.ItemHistory.html#maximumSince">maximumSince</a></li><li data-type='method'><a href="items.ItemHistory.html#minimumSince">minimumSince</a></li><li data-type='method'><a href="items.ItemHistory.html#persist">persist</a></li><li data-type='method'><a href="items.ItemHistory.html#previousState">previousState</a></li><li data-type='method'><a href="items.ItemHistory.html#sumSince">sumSince</a></li><li data-type='method'><a href="items.ItemHistory.html#updatedSince">updatedSince</a></li><li data-type='method'><a href="items.ItemHistory.html#varianceSince">varianceSince</a></li><li data-type='method'><a href="items.ItemHistory.html#latestState">latestState</a></li></ul></li><li><a href="items.Item.html">Item</a><ul class='methods'><li data-type='method'><a href="items.Item.html#getMetadataValue">getMetadataValue</a></li><li data-type='method'><a href="items.Item.html#updateMetadataValue">updateMetadataValue</a></li><li data-type='method'><a href="items.Item.html#upsertMetadataValue">upsertMetadataValue</a></li><li data-type='method'><a href="items.Item.html#updateMetadataValues">updateMetadataValues</a></li><li data-type='method'><a href="items.Item.html#sendCommand">sendCommand</a></li><li data-type='method'><a href="items.Item.html#sendCommandIfDifferent">sendCommandIfDifferent</a></li><li data-type='method'><a href="items.Item.html#postUpdate">postUpdate</a></li><li data-type='method'><a href="items.Item.html#addGroups">addGroups</a></li><li data-type='method'><a href="items.Item.html#removeGroups">removeGroups</a></li><li data-type='method'><a href="items.Item.html#addTags">addTags</a></li><li data-type='method'><a href="items.Item.html#removeTags">removeTags</a></li></ul></li><li><a href="log.Logger.html">Logger</a><ul class='methods'><li data-type='method'><a href="log.Logger.html#error">error</a></li><li data-type='method'><a href="log.Logger.html#warn">warn</a></li><li data-type='method'><a href="log.Logger.html#info">info</a></li><li data-type='method'><a href="log.Logger.html#debug">debug</a></li><li data-type='method'><a href="log.Logger.html#trace">trace</a></li><li data-type='method'><a href="log.Logger.html#atLevel">atLevel</a></li></ul></li><li><a href="ConditionBuilder.html">ConditionBuilder</a><ul class='methods'><li data-type='method'><a href="ConditionBuilder.html#then">then</a></li><li data-type='method'><a href="ConditionBuilder.html#stateOfItem">stateOfItem</a></li></ul></li><li><a href="ConditionBuilder.ConditionConf.html">ConditionConf</a><ul class='methods'><li data-type='method'><a href="ConditionBuilder.ConditionConf.html#then">then</a></li></ul></li><li><a href="ConditionBuilder.FunctionConditionConf.html">FunctionConditionConf</a><ul class='methods'><li data-type='method'><a href="ConditionBuilder.FunctionConditionConf.html#then">then</a></li></ul></li><li><a href="ConditionBuilder.ItemStateConditionConf.html">ItemStateConditionConf</a><ul class='methods'><li data-type='method'><a href="ConditionBuilder.ItemStateConditionConf.html#is">is</a></li><li data-type='method'><a href="ConditionBuilder.ItemStateConditionConf.html#in">in</a></li><li data-type='method'><a href="ConditionBuilder.ItemStateConditionConf.html#then">then</a></li></ul></li><li><a href="OperationBuilder.html">OperationBuilder</a><ul class='methods'><li data-type='method'><a href="OperationBuilder.html#build">build</a></li><li data-type='method'><a href="OperationBuilder.html#inGroup">inGroup</a></li><li data-type='method'><a href="OperationBuilder.html#send">send</a></li><li data-type='method'><a href="OperationBuilder.html#postUpdate">postUpdate</a></li><li data-type='method'><a href="OperationBuilder.html#sendOn">sendOn</a></li><li data-type='method'><a href="OperationBuilder.html#sendOff">sendOff</a></li><li data-type='method'><a href="OperationBuilder.html#sendToggle">sendToggle</a></li><li data-type='method'><a href="OperationBuilder.html#sendIt">sendIt</a></li><li data-type='method'><a href="OperationBuilder.html#postIt">postIt</a></li><li data-type='method'><a href="OperationBuilder.html#copyState">copyState</a></li><li data-type='method'><a href="OperationBuilder.html#copyAndSendState">copyAndSendState</a></li></ul></li><li><a href="OperationBuilder.OperationConfig.html">OperationConfig</a><ul class='methods'><li data-type='method'><a href="OperationBuilder.OperationConfig.html#inGroup">inGroup</a></li><li data-type='method'><a href="OperationBuilder.OperationConfig.html#build">build</a></li></ul></li><li><a href="OperationBuilder.CopyStateOperation.html">CopyStateOperation</a><ul class='methods'><li data-type='method'><a href="OperationBuilder.CopyStateOperation.html#fromItem">fromItem</a></li><li data-type='method'><a href="OperationBuilder.CopyStateOperation.html#toItem">toItem</a></li><li data-type='method'><a href="OperationBuilder.CopyStateOperation.html#and">and</a></li><li data-type='method'><a href="OperationBuilder.CopyStateOperation.html#inGroup">inGroup</a></li><li data-type='method'><a href="OperationBuilder.CopyStateOperation.html#build">build</a></li></ul></li><li><a href="OperationBuilder.SendCommandOrUpdateOperation.html">SendCommandOrUpdateOperation</a><ul class='methods'><li data-type='method'><a href="OperationBuilder.SendCommandOrUpdateOperation.html#toItems">toItems</a></li><li data-type='method'><a href="OperationBuilder.SendCommandOrUpdateOperation.html#toItem">toItem</a></li><li data-type='method'><a href="OperationBuilder.SendCommandOrUpdateOperation.html#and">and</a></li><li data-type='method'><a href="OperationBuilder.SendCommandOrUpdateOperation.html#inGroup">inGroup</a></li><li data-type='method'><a href="OperationBuilder.SendCommandOrUpdateOperation.html#build">build</a></li></ul></li><li><a href="OperationBuilder.ToggleOperation.html">ToggleOperation</a><ul class='methods'><li data-type='method'><a href="OperationBuilder.ToggleOperation.html#doToggle">doToggle</a></li><li data-type='method'><a href="OperationBuilder.ToggleOperation.html#inGroup">inGroup</a></li><li data-type='method'><a href="OperationBuilder.ToggleOperation.html#build">build</a></li></ul></li><li><a href="OperationBuilder.TimingItemStateOperation.html">TimingItemStateOperation</a><ul class='methods'><li data-type='method'><a href="OperationBuilder.TimingItemStateOperation.html#inGroup">inGroup</a></li><li data-type='method'><a href="OperationBuilder.TimingItemStateOperation.html#build">build</a></li></ul></li><li><a href="RuleBuilder.html">RuleBuilder</a><ul class='methods'><li data-type='method'><a href="RuleBuilder.html#when">when</a></li></ul></li><li><a href="TriggerBuilder.html">TriggerBuilder</a><ul class='methods'><li data-type='method'><a href="TriggerBuilder.html#channel">channel</a></li><li data-type='method'><a href="TriggerBuilder.html#cron">cron</a></li><li data-type='method'><a href="TriggerBuilder.html#item">item</a></li><li data-type='method'><a href="TriggerBuilder.html#memberOf">memberOf</a></li><li data-type='method'><a href="TriggerBuilder.html#thing">thing</a></li><li data-type='method'><a href="TriggerBuilder.html#system">system</a></li></ul></li><li><a href="TriggerBuilder.TriggerConf.html">TriggerConf</a><ul class='methods'><li data-type='method'><a href="TriggerBuilder.TriggerConf.html#or">or</a></li><li data-type='method'><a href="TriggerBuilder.TriggerConf.html#then">then</a></li><li data-type='method'><a href="TriggerBuilder.TriggerConf.html#if">if</a></li></ul></li><li><a href="TriggerBuilder.ChannelTriggerConfig.html">ChannelTriggerConfig</a><ul class='methods'><li data-type='method'><a href="TriggerBuilder.ChannelTriggerConfig.html#to">to</a></li><li data-type='method'><a href="TriggerBuilder.ChannelTriggerConfig.html#triggered">triggered</a></li><li data-type='method'><a href="TriggerBuilder.ChannelTriggerConfig.html#or">or</a></li><li data-type='method'><a href="TriggerBuilder.ChannelTriggerConfig.html#then">then</a></li><li data-type='method'><a href="TriggerBuilder.ChannelTriggerConfig.html#if">if</a></li></ul></li><li><a href="TriggerBuilder.CronTriggerConfig.html">CronTriggerConfig</a><ul class='methods'><li data-type='method'><a href="TriggerBuilder.CronTriggerConfig.html#or">or</a></li><li data-type='method'><a href="TriggerBuilder.CronTriggerConfig.html#then">then</a></li><li data-type='method'><a href="TriggerBuilder.CronTriggerConfig.html#if">if</a></li></ul></li><li><a href="TriggerBuilder.ItemTriggerConfig.html">ItemTriggerConfig</a><ul class='methods'><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#to">to</a></li><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#from">from</a></li><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#toOff">toOff</a></li><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#toOn">toOn</a></li><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#receivedCommand">receivedCommand</a></li><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#receivedUpdate">receivedUpdate</a></li><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#changed">changed</a></li><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#for">for</a></li><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#or">or</a></li><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#then">then</a></li><li data-type='method'><a href="TriggerBuilder.ItemTriggerConfig.html#if">if</a></li></ul></li><li><a href="TriggerBuilder.ThingTriggerConfig.html">ThingTriggerConfig</a><ul class='methods'><li data-type='method'><a href="TriggerBuilder.ThingTriggerConfig.html#changed">changed</a></li><li data-type='method'><a href="TriggerBuilder.ThingTriggerConfig.html#updated">updated</a></li><li data-type='method'><a href="TriggerBuilder.ThingTriggerConfig.html#from">from</a></li><li data-type='method'><a href="TriggerBuilder.ThingTriggerConfig.html#to">to</a></li><li data-type='method'><a href="TriggerBuilder.ThingTriggerConfig.html#or">or</a></li><li data-type='method'><a href="TriggerBuilder.ThingTriggerConfig.html#then">then</a></li><li data-type='method'><a href="TriggerBuilder.ThingTriggerConfig.html#if">if</a></li></ul></li><li><a href="TriggerBuilder.SystemTriggerConfig.html">SystemTriggerConfig</a><ul class='methods'><li data-type='method'><a href="TriggerBuilder.SystemTriggerConfig.html#rulesLoaded">rulesLoaded</a></li><li data-type='method'><a href="TriggerBuilder.SystemTriggerConfig.html#ruleEngineStarted">ruleEngineStarted</a></li><li data-type='method'><a href="TriggerBuilder.SystemTriggerConfig.html#userInterfacesStarted">userInterfacesStarted</a></li><li data-type='method'><a href="TriggerBuilder.SystemTriggerConfig.html#thingsInitialized">thingsInitialized</a></li><li data-type='method'><a href="TriggerBuilder.SystemTriggerConfig.html#startupComplete">startupComplete</a></li><li data-type='method'><a href="TriggerBuilder.SystemTriggerConfig.html#startLevel">startLevel</a></li><li data-type='method'><a href="TriggerBuilder.SystemTriggerConfig.html#or">or</a></li><li data-type='method'><a href="TriggerBuilder.SystemTriggerConfig.html#then">then</a></li><li data-type='method'><a href="TriggerBuilder.SystemTriggerConfig.html#if">if</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#DYNAMIC_ITEM_TAG">DYNAMIC_ITEM_TAG</a></li><li><a href="global.html#LOGGER_PREFIX">LOGGER_PREFIX</a></li><li><a href="global.html#upsertValue">upsertValue</a></li><li><a href="global.html#registeredServices">registeredServices</a></li><li><a href="global.html#isEnabled">isEnabled</a></li><li><a href="global.html#setEnabled">setEnabled</a></li></ul>
</nav>

<div id="main">
    

    



    


    <section class="package">
        <h3>openhab 1.2.2</h3>		
    </section>









    



    <section class="readme usertext">
        <article><hr>
<h2>layout: documentation
title: openHAB Javascript Library
source: https://github.com/openhab/openhab-js/blob/main/README.md
description: &quot;Fairly high-level ES6 library to support automation in openHAB. It provides convenient access to common openHAB functionality within rules including items, things, actions, logging and more.&quot;</h2>
<h1>openHAB Javascript Library</h1>
<p><a href="https://github.com/openhab/openhab-js/actions/workflows/build.yaml"><img src="https://github.com/openhab/openhab-js/actions/workflows/build.yaml/badge.svg" alt="BuildStatus"></a> <a href="https://badge.fury.io/js/openhab"><img src="https://badge.fury.io/js/openhab.svg" alt="npm version"></a></p>
<p>This library aims to be a fairly high-level ES6 library to support automation in openHAB.
It provides convenient access to common openHAB functionality within rules including items, things, actions, logging and more.</p>
<p>This library is included by default in the openHAB <a href="https://www.openhab.org/addons/automation/jsscripting/">JavaScript
binding</a></p>
<ul>
<li><a href="#installation">Installation</a>
<ul>
<li><a href="#default-installation">Default Installation</a></li>
<li><a href="#custom-installation">Custom Installation</a></li>
<li><a href="#configuration">Configuration</a></li>
</ul>
</li>
<li><a href="#latest-changes">Latest Changes</a>
<ul>
<li><a href="#breaking-changes">Breaking Changes</a></li>
</ul>
</li>
<li><a href="#ui-based-rules">UI Based Rules</a>
<ul>
<li><a href="#adding-triggers">Adding Triggers</a></li>
<li><a href="#adding-actions">Adding Actions</a></li>
</ul>
</li>
<li><a href="#scripting-basics">Scripting Basics</a>
<ul>
<li><a href="#require">Require</a></li>
<li><a href="#console">Console</a></li>
<li><a href="#timers">Timers</a></li>
<li><a href="#scriptloaded">ScriptLoaded</a></li>
<li><a href="#scriptunloaded">ScriptUnLoaded</a></li>
<li><a href="#paths">Paths</a></li>
</ul>
</li>
<li><a href="#standard-library">Standard Library</a>
<ul>
<li><a href="#items">Items</a></li>
<li><a href="#actions">Actions</a></li>
<li><a href="#cache">Cache</a></li>
<li><a href="#log">Log</a></li>
<li><a href="#time">Time</a></li>
<li><a href="#utils">Utils</a></li>
</ul>
</li>
<li><a href="#file-based-rules">File Based Rules</a>
<ul>
<li><a href="#jsrule">JSRule</a></li>
<li><a href="#rule-builder">Rule Builder</a></li>
</ul>
</li>
</ul>
<h2>Installation</h2>
<h3>Default Installation</h3>
<ul>
<li>Install the openHAB <a href="https://www.openhab.org/addons/automation/jsscripting/">JavaScript binding</a>, a version of this
library will be automatically installed and available to all javascript rules by default.</li>
</ul>
<h3>Custom Installation</h3>
<ul>
<li>Go to the javascript user scripts directory: <code>cd $OPENHAB_CONF/automation/js</code></li>
<li>Run <code>npm i openhab</code> (you may need to install npm)</li>
</ul>
<p>NPM will create a <code>node_modules</code> directory containing the latest version of this library.
This will be used instead of the binding provided version.</p>
<h3>Configuration</h3>
<h2>Latest Changes</h2>
<h3>Breaking Changes</h3>
<ul>
<li>item.history.lastUpdate() returns <code>ZonedDateTime</code> instead of <code>Date</code></li>
</ul>
<h2>UI Based Rules</h2>
<p>The quickest way to add rules is through the openHAB Web UI.</p>
<p>Advanced users, or users migrating scripts from existing systems may want to use <a href="#file-based-rules">File Based Rules</a> for managing rules using files in the user configuration directory.</p>
<h3>Adding Triggers</h3>
<p>Using the openHAB UI, first create a new rule and set a trigger condition</p>
<p><img src="/images/rule-config.png" alt="openHAB Rule Configuration"></p>
<h3>Adding Actions</h3>
<p>Select &quot;Add Action&quot; and then select &quot;ECMAScript 262 Edition 11&quot;.
Its important this is &quot;Edition 11&quot; or higher, earlier versions will not work.
This will bring up a empty script editor where you can enter your javascript.</p>
<p><img src="/images/rule-engines.png" alt="openHAB Rule Engines"></p>
<p>You can now write rules using standard ES6 Javascript along with the included openHAB <a href="#standard-library">standard library</a>.</p>
<p><img src="/images/rule-script.png" alt="openHAB Rule Script"></p>
<p>For example, turning a light on:</p>
<pre class="prettyprint source lang-javascript"><code>items.getItem(&quot;KitchenLight&quot;).sendCommand(&quot;ON&quot;);
console.log(&quot;Kitchen Light State&quot;, items.getItem(&quot;KitchenLight&quot;).state);
</code></pre>
<p>Sending a notification</p>
<pre class="prettyprint source lang-javascript"><code>actions.NotificationAction.sendNotification(&quot;romeo@montague.org&quot;, &quot;Balcony door is open&quot;);
</code></pre>
<p>Querying the status of a thing</p>
<pre class="prettyprint source lang-javascript"><code>const thingStatusInfo = actions.Things.getThingStatusInfo(&quot;zwave:serial_zstick:512&quot;);
console.log(&quot;Thing status&quot;,thingStatusInfo.getStatus());
</code></pre>
<p>See <a href="https://openhab.github.io/openhab-js">openhab-js</a> for a complete list of functionality</p>
<h2>Scripting Basics</h2>
<p>The openHAB JSScripting runtime attempts to provide a familiar environment to Javascript developers.</p>
<h3>Require</h3>
<p>Scripts may include standard NPM based libraries by using CommonJS require.
The library search path will look in <code>automation/js/node_modules</code> in the user configuration directory.</p>
<h3>Console</h3>
<p>The JSScripting binding supports the standard <code>console</code> object for logging.
Script debug logging is enabled by default at the <code>INFO</code> level, but can be configured using the <a href="%7B%7Bbase%7D%7D/administration/logging.html">console logging</a> commands.</p>
<pre class="prettyprint source lang-text"><code>log:set DEBUG org.openhab.automation.script
</code></pre>
<p>The default logger name prefix is <code>org.openhab.automation.script</code>, this can be changed by assigning a new prefix to the <code>loggerName</code> property of the console.</p>
<pre class="prettyprint source lang-javascript"><code>console.loggerName = &quot;custom&quot;
</code></pre>
<p>Supported logging functions include:</p>
<ul>
<li><code>console.log(obj1 [, obj2, ..., objN])</code></li>
<li><code>console.info(obj1 [, obj2, ..., objN])</code></li>
<li><code>console.warn(obj1 [, obj2, ..., objN])</code></li>
<li><code>console.error(obj1 [, obj2, ..., objN])</code></li>
<li><code>console.debug(obj1 [, obj2, ..., objN])</code></li>
<li><code>console.trace(obj1 [, obj2, ..., objN])</code></li>
</ul>
<p>where <code>obj1 ... objN</code> is a list of JavaScript objects to output.
The string representations of each of these objects are appended together in the order listed and output.</p>
<p>see https://developer.mozilla.org/en-US/docs/Web/API/console for more information about console logging.</p>
<h3>Timers</h3>
<h4>SetTimeout</h4>
<p>The global <code>setTimeout()</code> method sets a timer which executes a function or specified piece of code once the timer expires.</p>
<pre class="prettyprint source lang-javascript"><code>var timeoutID = setTimeout(function[, delay, arg1, arg2, ...]);
var timeoutID = setTimeout(function[, delay]);
</code></pre>
<p>The global <code>clearTimeout()</code> method cancels a timeout previously established by calling <code>setTimeout()</code>.</p>
<p>See https://developer.mozilla.org/en-US/docs/Web/API/setTimeout for more information about setTimeout.</p>
<p>openHAB does not return the integer timeoutID as standard JS does, instead it returns an instance of <a href="#openhab-timer">openHAB Timer</a>.</p>
<h4>SetInterval</h4>
<p>The setInterval() method repeatedly calls a function or executes a code snippet, with a fixed time delay between each call.</p>
<pre class="prettyprint source lang-javascript"><code>var intervalID = setInterval(func, [delay, arg1, arg2, ...]);
var intervalID = setInterval(function[, delay]);
</code></pre>
<p>The global <code>clearInterval()</code> method cancels a timed, repeating action which was previously established by a call to <code>setInterval()</code>.</p>
<p>NOTE: Timers will not be canceled if a script is deleted or modified, it is up to the user to manage timers.  See using the <a href="#cache">cache</a> namespace as well as <a href="#scriptloaded">ScriptLoaded</a> and <a href="#scriptunloaded">ScriptUnLoaded</a> for a convenient way of managing persisted objects, such as timers between reloads or deletions of scripts.</p>
<p>See https://developer.mozilla.org/en-US/docs/Web/API/setInterval for more information about setInterval.</p>
<p>openHAB does not return the integer timeoutID as standard JS does, instead it returns an instance of <a href="#openhab-timer">openHAB Timer</a>.</p>
<h4>openHAB Timer</h4>
<p>A native openHAB Timer instance has the following methods:</p>
<ul>
<li><code>cancel()</code>: Cancels the timer. ⇒ <code>boolean</code>: true, if cancellation was successful</li>
<li><code>getExecutionTime()</code>: The scheduled execution time or null if timer was cancelled. ⇒ <code>time.ZonedDateTime</code> or <code>null</code></li>
<li><code>isActive()</code>: Whether the scheduled execution is yet to happen. ⇒ <code>boolean</code></li>
<li><code>isCancelled()</code>: Whether the timer has been cancelled. ⇒ <code>boolean</code></li>
<li><code>isRunning()</code>: Whether the scheduled code is currently executed. ⇒ <code>boolean</code></li>
<li><code>hasTerminated()</code>: Whether the scheduled execution has already terminated. ⇒ <code>boolean</code></li>
<li><code>reschedule(time.ZonedDateTime)</code>: Reschedules a timer to a new starting time. This can also be called after a timer has terminated, which will result in another execution of the same code. ⇒ <code>boolean</code>: true, if rescheduling was successful</li>
</ul>
<p>Examples:</p>
<pre class="prettyprint source lang-javascript"><code>var timer = setTimeout(() => { console.log('Timer expired.'); }, 10000); // Would log 'Timer expired.' in 10s.
if (timer.isActive()) console.log('Timer is waiting to execute.');
timer.cancel();
if (timer.isCancelled()) console.log('Timer has been cancelled.');
timer.reschedule(time.ZonedDateTime.now().plusSeconds(2)); // Logs 'Timer expired.' in 2s.
</code></pre>
<p>See <a href="https://www.openhab.org/javadoc/latest/org/openhab/core/model/script/actions/timer">openHAB JavaDoc - Timer</a> for full API documentation.</p>
<h3>ScriptLoaded</h3>
<p>For file based scripts, this function will be called if found when the script is loaded.</p>
<pre class="prettyprint source lang-javascript"><code>scriptLoaded = function () {
    console.log(&quot;script loaded&quot;);
    loadedDate = Date.now();
}
</code></pre>
<h3>ScriptUnLoaded</h3>
<p>For file based scripts, this function will be called if found when the script is unloaded.</p>
<pre class="prettyprint source lang-javascript"><code>scriptUnloaded = function () {
    console.log(&quot;script unloaded&quot;);
    //clean up rouge timers
    clearInterval(timer);
}
</code></pre>
<h3>Paths</h3>
<p>For <a href="#file-based-rules">file based rules</a>, scripts will be loaded from <code>automation/js</code> in the user configuration directory.</p>
<p>NPM libraries will be loaded from <code>automation/js/node_modules</code> in the user configuration directory.</p>
<h2>Standard Library</h2>
<p>Full documentation for the openHAB JavaScript library can be found at <a href="https://openhab.github.io/openhab-js">openhab-js</a></p>
<h3>Items</h3>
<p>The items namespace allows interactions with openHAB items.</p>
<p>See <a href="https://openhab.github.io/openhab-js/items.html">openhab-js : items</a> for full API documentation</p>
<ul>
<li>items : <code>object</code>
<ul>
<li>.getItem(name, nullIfMissing) ⇒ <code>Item</code></li>
<li>.getItems() ⇒ <code>Array.&lt;Item&gt;</code></li>
<li>.getItemsByTag(...tagNames) ⇒ <code>Array.&lt;Item&gt;</code></li>
<li>.createItem(itemName, [itemType], [category], [groups], [label], [tags], [giBaseType], [groupFunction], [itemMetadata])</li>
<li>.addItem(itemName, [itemType], [category], [groups], [label], [tags], [giBaseType], [groupFunction])</li>
<li>.removeItem(itemOrItemName) ⇒ <code>Boolean</code></li>
<li>.replaceItem(itemName, [itemType], [category], [groups], [label], [tags], [giBaseType], [groupFunction])</li>
<li>.safeItemName(s) ⇒ <code>String</code></li>
</ul>
</li>
</ul>
<pre class="prettyprint source lang-javascript"><code>const item = items.getItem(&quot;KitchenLight&quot;);
console.log(&quot;Kitchen Light State&quot;, item.state);
</code></pre>
<p>Calling <code>getItem(...)</code> returns an <code>Item</code> object with the following properties:</p>
<ul>
<li>Item : <code>object</code>
<ul>
<li>.type ⇒ <code>String</code></li>
<li>.name ⇒ <code>String</code></li>
<li>.label ⇒ <code>String</code></li>
<li>.history ⇒ <code>ItemHistory</code></li>
<li>.state ⇒ <code>String</code></li>
<li>.rawState ⇒ <code>HostState</code></li>
<li>.members ⇒ <code>Array.&lt;Item&gt;</code></li>
<li>.descendents ⇒ <code>Array.&lt;Item&gt;</code></li>
<li>.isUninitialized ⇒ <code>Boolean</code></li>
<li>.groupNames ⇒ <code>Array.&lt;String&gt;</code></li>
<li>.tags ⇒ <code>Array.&lt;String&gt;</code></li>
<li>.getMetadataValue(namespace) ⇒ <code>String</code></li>
<li>.updateMetadataValue(namespace, value) ⇒ <code>String</code></li>
<li>.upsertMetadataValue(namespace, value) ⇒ <code>Boolean</code></li>
<li>.updateMetadataValues(namespaceToValues)</li>
<li>.sendCommand(value)</li>
<li>.sendCommandIfDifferent(value) ⇒ <code>Boolean</code></li>
<li>.postUpdate(value)</li>
<li>.addGroups(...groupNamesOrItems)</li>
<li>.removeGroups(...groupNamesOrItems)</li>
<li>.addTags(...tagNames)</li>
<li>.removeTags(...tagNames)</li>
</ul>
</li>
</ul>
<pre class="prettyprint source lang-javascript"><code>const item = items.getItem(&quot;KitchenLight&quot;);
//send a ON command
item.sendCommand(&quot;ON&quot;);
//Post an update
item.postUpdate(&quot;OFF&quot;);
//Get state
console.log(&quot;KitchenLight state&quot;, item.state)
</code></pre>
<p>calling <code>item.history...</code> returns a ItemHistory object with the following functions:</p>
<p>Note <code>serviceId</code> is optional, if omitted, the default persistance service will be used.</p>
<ul>
<li>ItemHistory : <code>object</code>
<ul>
<li>.averageSince(timestamp, serviceId) ⇒ <code>Number</code></li>
<li>.changedSince(timestamp, serviceId) ⇒ <code>Number</code></li>
<li>.deltaSince(timestamp, serviceId) ⇒ <code>Number</code></li>
<li>.deviationSince(timestamp, serviceId) ⇒ <code>Number</code></li>
<li>.evolutionRate(timestamp, serviceId) ⇒ <code>Number</code></li>
<li>.historicState(timestamp, serviceId) ⇒ <code>state</code></li>
<li>.lastUpdate(serviceId) ⇒ <code>Date</code></li>
<li>.latestState(serviceId) ⇒ <code>state</code></li>
<li>.maximumSince(timestamp,serviceId) ⇒ <code>state</code></li>
<li>.minimumSince(timestamp,serviceId) ⇒ <code>state</code></li>
<li>.persist(serviceId)</li>
<li>.previousState(skipEqual,serviceId) ⇒ <code>state</code></li>
<li>.sumSince(timestamp, serviceId) ⇒ <code>Number</code></li>
<li>.updatedSince(timestamp, serviceId) ⇒ <code>Boolean</code></li>
<li>.varianceSince(timestamp,serviceId) ⇒ <code>state</code></li>
</ul>
</li>
</ul>
<pre class="prettyprint source lang-javascript"><code>var yesterday = new Date(new Date().getTime() - (24 * 60 * 60 * 1000));
var item = items.getItem(&quot;KitchenDimmer&quot;);
console.log(&quot;KitchenDimmer averageSince&quot;, item.history.averageSince(yesterday));
</code></pre>
<h3>Actions</h3>
<p>The actions namespace allows interactions with openHAB actions.
The following are a list of standard actions.</p>
<p>Additional actions provided by user installed addons can be accessed using their common name on the actions name space
(example:  <code>actions.Pushsafer.pushsafer(...)</code>)</p>
<p>See <a href="https://openhab.github.io/openhab-js/actions.html">openhab-js : actions</a> for full API documentation and additional actions.</p>
<h4>Audio Actions</h4>
<p>See <a href="https://openhab.github.io/openhab-js/actions.html#.Audio">openhab-js : actions.Audio</a> for complete documentation.</p>
<h4>BusEvent</h4>
<p>See <a href="https://openhab.github.io/openhab-js/actions.html#.BusEvent">openhab-js : actions.BusEvent</a> for complete documentation.</p>
<h4>Ephemeris Actions</h4>
<p>See <a href="https://openhab.github.io/openhab-js/actions.html#.Ephemeris">openhab-js : actions.Ephemeris</a> for complete documentation</p>
<p>Ephemeris is a way to determine what type of day today or a number of days before or after today is. For example, a way to determine if today is a weekend, a bank holiday, someone’s birthday, trash day, etc.</p>
<p>Additional information can be found on the  <a href="https://www.openhab.org/docs/configuration/actions.html#ephemeris">Ephemeris Actions Docs</a> as well as the <a href="https://www.openhab.org/javadoc/latest/org/openhab/core/model/script/actions/ephemeris">Ephemeris JavaDoc</a>.</p>
<pre class="prettyprint source lang-javascript"><code>// Example
let weekend = actions.Ephemeris.isWeekend();
</code></pre>
<h4>Exec Actions</h4>
<p>See <a href="https://openhab.github.io/openhab-js/actions.html#.Exec">openhab-js : actions.Exec</a> for complete documentation.</p>
<p>Execute a command line.</p>
<pre class="prettyprint source lang-javascript"><code>
// Execute command line.
actions.Exec.executeCommandLine('echo', 'Hello World!');

// Execute command line with timeout.
let Duration = Java.type('java.time.Duration');
actions.Exec.executeCommandLine(Duration.ofSeconds(20), 'echo', 'Hello World!');

// Get response from command line.
let response = actions.Exec.executeCommandLine('echo', 'Hello World!');

// Get response from command line with timeout.
response = actions.Exec.executeCommandLine(Duration.ofSeconds(20), 'echo', 'Hello World!');
</code></pre>
<h4>HTTP Actions</h4>
<p>See <a href="https://openhab.github.io/openhab-js/actions.html#.HTTP">openhab-js : actions.HTTP</a> for complete documentation</p>
<pre class="prettyprint source lang-javascript"><code>// Example GET Request
var response = actions.HTTP.sendHttpGetRequest('&lt;url>');
</code></pre>
<p>Replace <code>&lt;url&gt;</code> with the request url.</p>
<h4>ScriptExecution Actions</h4>
<p>See <a href="https://openhab.github.io/openhab-js/actions.html#.ScriptExecution">openhab-js : actions.ScriptExecution</a> for complete documentation</p>
<pre class="prettyprint source lang-javascript"><code>let now = time.ZonedDateTime.now();

// Function to run when the timer goes off.
function timerOver () {
  logger.info('The timer is over.');
}

// Create the Timer.
this.myTimer = actions.ScriptExecution.createTimer(now.plusSeconds(10), timerOver);

// Cancel the timer.
this.myTimer.cancel();

// Check whether the timer is active. Returns true if the timer is active and will be executed as scheduled.
let active = this.myTimer.isActive();

// Reschedule the timer.
this.myTimer.reschedule(now.plusSeconds(5));
</code></pre>
<h4>Semantics Actions</h4>
<p>See <a href="https://openhab.github.io/openhab-js/actions.html#.Semantics">openhab-js : actions.Semantics</a> for complete documentation</p>
<h4>Things Actions</h4>
<p>See <a href="https://openhab.github.io/openhab-js/actions.html#.Things">openhab-js : actions.Things</a> for complete documentation</p>
<h4>Voice Actions</h4>
<p>See <a href="https://openhab.github.io/openhab-js/actions.html#.Voice">openhab-js : actions.Voice</a> for complete documentation</p>
<h4>Cloud Notification Actions</h4>
<p>(optional action if openhab-cloud is installed)</p>
<p>Notification actions may be placed in Rules to send alerts to mobile devices registered with an <a href="https://github.com/openhab/openhab-cloud">openHAB Cloud instance</a> such as <a href="https://myopenhab.org/">myopenHAB.org</a>.</p>
<p>For available actions have a look at the <a href="https://www.openhab.org/docs/configuration/actions.html#cloud-notification-actions">Cloud Notification Actions Docs</a>.</p>
<pre class="prettyprint source lang-javascript"><code>// Example
actions.NotificationAction.sendNotification('&lt;email>', '&lt;message>'); // to a single myopenHAB user identified by e-mail
actions.NotificationAction.sendBroadcastNotification('&lt;message>'); // to all myopenHAB users
</code></pre>
<p>Replace <code>&lt;email&gt;</code> with the e-mail address of the user.
Replace <code>&lt;message&gt;</code> with the notification text.</p>
<h3>Cache</h3>
<p>The cache namespace provides a default cache that can be use to set and retrieve objects that will be persisted between reloads of scripts.</p>
<p>See <a href="https://openhab.github.io/openhab-js/cache.html">openhab-js : cache</a> for full API documentation.</p>
<ul>
<li>cache : <code>object</code>
<ul>
<li>.get(key, defaultSupplier) ⇒ <code>Object | null</code></li>
<li>.put(key, value) ⇒ <code>Previous Object | null</code></li>
<li>.remove(key) ⇒ <code>Previous Object | null</code></li>
<li>.exists(key) ⇒ <code>boolean</code></li>
</ul>
</li>
</ul>
<p>The <code>defaultSupplier</code> provided function will return a default value if a specified key is not already associated with a value</p>
<p><strong>Example</strong> <em>(Get a previously set value with a default value (times = 0))</em></p>
<pre class="prettyprint source lang-js"><code>let counter = cache.get(&quot;counter&quot;, () => ({ &quot;times&quot;: 0 }));
console.log(&quot;Count&quot;,counter.times++);
</code></pre>
<p><strong>Example</strong> <em>(Get a previously set object)</em></p>
<pre class="prettyprint source lang-js"><code>let counter = cache.get(&quot;counter&quot;);
if(counter == null){
     counter = {times: 0};
     cache.put(&quot;counter&quot;, counter);
}
console.log(&quot;Count&quot;,counter.times++);
</code></pre>
<h3>Log</h3>
<p>By default the JS Scripting binding supports console logging like <code>console.log()</code> and <code>console.debug()</code> to the openHAB default log.
Additionally scripts may create their own native openHAB logs using the log namespace.</p>
<pre class="prettyprint source lang-javascript"><code>let logger = log('my_logger');

//prints &quot;Hello World!&quot;
logger.debug(&quot;Hello {}!&quot;, &quot;world&quot;);
</code></pre>
<h3>Time</h3>
<p>openHAB internally makes extensive use of the <code>java.time</code> package.
openHAB-JS exports the excellent <a href="#https://js-joda.github.io/js-joda/">JS-Joda</a> library via the <code>time</code> namespace, which is a native Javascript port of the same API standard used in Java for <code>java.time</code>.
Anywhere that a native Java <code>ZonedDateTime</code> or <code>Duration</code> is required, the runtime will automatically convert a JS-Joda <code>ZonedDateTime</code> or <code>Duration</code> to its Java counterpart.</p>
<h4>openHAB-JS extensions to JS-Joda</h4>
<p>The  exported <a href="#https://js-joda.github.io/js-joda/">JS-Joda</a> library is also extended with convenient functions relevant to openHAB usage.</p>
<ul>
<li><code>ZonedDateTime</code>
<ul>
<li><code>millisFromNow()</code> ⇒ <code>number</code>: Milliseconds from now until the <code>time.ZonedDateTime</code> representation.</li>
</ul>
</li>
</ul>
<p>Examples:</p>
<pre class="prettyprint source lang-javascript"><code>var now = time.ZonedDateTime.now();
var yesterday = time.ZonedDateTime.now().minusHours(24);
var millis = now.plusSeconds(5).millisFromNow();

var item = items.getItem(&quot;Kitchen&quot;);
console.log(&quot;averageSince&quot;, item.history.averageSince(yesterday));
console.log(&quot;5 seconds in the future is &quot; + millis + &quot; milliseconds.&quot;);
</code></pre>
<pre class="prettyprint source lang-javascript"><code>actions.Exec.executeCommandLine(time.Duration.ofSeconds(20), 'echo', 'Hello World!');
</code></pre>
<p>See <a href="https://js-joda.github.io/js-joda/">JS-Joda</a> for more examples and complete API usage.</p>
<h3>Utils</h3>
<p>openHAB internally is a Java program.
openHAB-JS converts between Java and JavaScript data types and reverse.</p>
<p>See <a href="https://openhab.github.io/openhab-js/utils.html">openhab-js : utils</a> for full API documentation</p>
<h2>File Based Rules</h2>
<p>The JSScripting binding  will load scripts from <code>automation/js</code> in the user configuration directory.
The system will automatically reload scripts when changes are detected to files.
Local variable state is not persisted among reloads, see using the <a href="#cache">cache</a> for a connivent way to persist objects.</p>
<p>File based rules can be created in 2 different ways: using <a href="#jsrule">JSRule</a> or the <a href="#rule-builder">Rule Builder</a>.</p>
<p>See <a href="https://openhab.github.io/openhab-js/rules.html">openhab-js : rules </a> for full API documentation</p>
<h3>JSRule</h3>
<p>JSRules provides a simple, declarative syntax for defining rules that will be executed based on a trigger condition</p>
<pre class="prettyprint source lang-javascript"><code>const email = &quot;juliet@capulet.org&quot;

rules.JSRule({
  name: &quot;Balcony Lights ON at 5pm&quot;,
  description: &quot;Light will turn on when it's 5:00pm&quot;,
  triggers: [triggers.GenericCronTrigger(&quot;0 0 17 * * ?&quot;)],
  execute: data => {
    items.getItem(&quot;BalconyLights&quot;).sendCommand(&quot;ON&quot;);
    actions.NotificationAction.sendNotification(email, &quot;Balcony lights are ON&quot;);
  },
  tags: [&quot;Balcony&quot;, &quot;Lights&quot;],
  id: &quot;BalconyLightsOn&quot;
});
</code></pre>
<p>Note: <code>description</code>, <code>tags</code> and <code>id</code> are optional.</p>
<p>Multiple triggers can be added,  some example triggers include:</p>
<pre class="prettyprint source lang-javascript"><code>triggers.ChannelEventTrigger('astro:sun:local:rise#event', 'START')

triggers.ItemStateChangeTrigger('my_item', 'OFF', 'ON')

triggers.ItemStateUpdateTrigger('my_item', 'OFF')

triggers.ItemCommandTrigger('my_item', 'OFF')

triggers.GroupStateChangeTrigger('my_group', 'OFF', 'ON')

triggers.GroupStateUpdateTrigger('my_group', 'OFF')

triggers.GroupCommandTrigger('my_group', 'OFF')

triggers.ThingStatusUpdateTrigger('some:thing:uuid','OFFLINE')

triggers.ThingStatusChangeTrigger('some:thing:uuid','ONLINE','OFFLINE')

triggers.SystemStartlevelTrigger(40)  //Rules loaded

triggers.SystemStartlevelTrigger(50)  //Rule engine started

triggers.SystemStartlevelTrigger(70)  //User interfaces started

triggers.SystemStartlevelTrigger(80)  //Things initialized

triggers.SystemStartlevelTrigger(100) //Startup Complete

triggers.GenericCronTrigger('0 30 16 * * ? *')

triggers.TimeOfDayTrigger('19:00')

</code></pre>
<p>See <a href="https://openhab.github.io/openhab-js/triggers.html">openhab-js : triggers </a> in the API documentation for a full list of all triggers.</p>
<h3>Rule Builder</h3>
<p>The Rule Builder provides a convenient API to write rules in a high-level, readable style using a builder pattern.</p>
<p>Rules are started by calling <code>rules.when()</code> and can chain together <a href="#rule-builder-triggers">triggers</a>,
<a href="#rule-builder-conditions">conditions</a> and <a href="#rule-builder-operations">operations</a> in the following pattern:</p>
<pre class="prettyprint source lang-javascript"><code>rules.when().triggerType()...if().conditionType().then().operationType()...build(name, description, tags, id);
</code></pre>
<p>Rule are completed by calling <code>.build(name, description, tags, id)</code> , all parameters are optional and reasonable defaults will be used if omitted.</p>
<ul>
<li><code>name</code> String rule name - defaults generated name</li>
<li><code>description</code> String Rule description - defaults generated description</li>
<li><code>tags</code> Array of string tag names - defaults empty array</li>
<li><code>id</code> String id - defaults random UUID</li>
</ul>
<p>A simple example of this would look like:</p>
<pre class="prettyprint source lang-javascript"><code>rules.when().item(&quot;F1_Light&quot;).changed().then().send(&quot;changed&quot;).toItem(&quot;F2_Light&quot;).build(&quot;My Rule&quot;, &quot;My First Rule&quot;);
</code></pre>
<p>Operations and conditions can also optionally take functions:</p>
<pre class="prettyprint source lang-javascript"><code>rules.when().item(&quot;F1_light&quot;).changed().then(event => {
    console.log(event);
}).build(&quot;Test Rule&quot;, &quot;My Test Rule&quot;);
</code></pre>
<p>see <a href="#rule-builder-examples">Examples</a> for further patterns</p>
<h4>Rule Builder Triggers</h4>
<ul>
<li><code>when()</code></li>
<li><code>or()</code>
<ul>
<li><code>.channel(channelName)</code> Specifies a channel event as a source for the rule to fire.
<ul>
<li><code>.triggered(event)</code> Trigger on a specific event name</li>
</ul>
</li>
<li><code>.cron(cronExpression)</code> Specifies a cron schedule for the rule to fire.</li>
<li><code>.item(itemName)</code> Specifies an item as the source of changes to trigger a rule.
<ul>
<li><code>.for(duration)</code></li>
<li><code>.from(state)</code></li>
<li><code>.to(state)</code></li>
<li><code>.fromOff()</code></li>
<li><code>.toOn()</code></li>
<li><code>.receivedCommand()</code></li>
<li><code>.receivedUpdate()</code></li>
</ul>
</li>
<li><code>.memberOf(groupName)</code>
<ul>
<li><code>.for(duration)</code></li>
<li><code>.from(state)</code></li>
<li><code>.to(state)</code></li>
<li><code>.fromOff()</code></li>
<li><code>.toOn()</code></li>
<li><code>.receivedCommand()</code></li>
<li><code>.receivedUpdate()</code></li>
</ul>
</li>
<li><code>.system()</code>
<ul>
<li><code>.ruleEngineStarted()</code></li>
<li><code>.rulesLoaded()</code></li>
<li><code>.startupComplete()</code></li>
<li><code>.thingsInitialized()</code></li>
<li><code>.userInterfacesStarted()</code></li>
<li><code>.startLevel(level)</code></li>
</ul>
</li>
<li><code>.thing(thingName)</code>
<ul>
<li><code>changed()</code></li>
<li><code>updated()</code></li>
<li><code>from(state)</code></li>
<li><code>to(state)</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Additionally all the above triggers have the following functions:</p>
<ul>
<li><code>.if()</code> or <code>.if(fn)</code> -&gt; a <a href="#rule-builder-conditions">rule condition</a></li>
<li><code>.then()</code> or <code>.then(fn)</code> -&gt; a <a href="#rule-builder-operations">rule operation</a></li>
<li><code>.or()</code> -&gt; a <a href="#rule-builder-triggers">rule trigger</a> (chain additional triggers)</li>
</ul>
<h4>Rule Builder Conditions</h4>
<ul>
<li><code>if(optionalFunction)</code>
<ul>
<li><code>.stateOfItem(itemName)</code>
<ul>
<li><code>is(state)</code></li>
<li><code>in(state...)</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4>Rule Builder Operations</h4>
<ul>
<li><code>then(optionalFunction)</code>
<ul>
<li><code>.build(name, description, tags, id)</code></li>
<li><code>.copyAndSendState()</code></li>
<li><code>.copyState()</code></li>
<li><code>.inGroup(groupName)</code></li>
<li><code>.postIt()</code></li>
<li><code>.postUpdate(state)</code></li>
<li><code>.send(command)</code></li>
<li><code>.sendIt()</code></li>
<li><code>.sendOff()</code></li>
<li><code>.sendOn()</code></li>
<li><code>.sendToggle()</code></li>
</ul>
</li>
</ul>
<h4>Rule Builder Examples</h4>
<pre class="prettyprint source lang-javascript"><code>//Basic rule, when the BedroomLight1 is changed, run a custom function
rules.when().item('BedroomLight1').changed().then(e => {
    console.log(&quot;BedroomLight1 state&quot;, e.newState)
}.build();

//turn on the kitchen light at SUNSET
rules.when().timeOfDay(&quot;SUNSET&quot;).then().sendOn().toItem(&quot;KitchenLight&quot;).build(&quot;Sunset Rule&quot;,&quot;turn on the kitchen light
at SUNSET&quot;);

//turn off the kitchen light at 9PM and tag rule
rules.when().cron(&quot;0 0 21 * * ?&quot;).then().sendOff().toItem(&quot;KitchenLight&quot;).build(&quot;9PM Rule&quot;, &quot;turn off the kitchen light
at 9PM&quot;, [&quot;Tag1&quot;, &quot;Tag2&quot;]);

//set the colour of the hall light to pink at 9PM, tag rule and use a custom ID
rules.when().cron(&quot;0 0 21 * * ?&quot;).then().send(&quot;300,100,100&quot;).toItem(&quot;HallLight&quot;).build(&quot;Pink Rule&quot;, &quot;set the colour of
the hall light to pink at 9PM&quot;, [&quot;Tag1&quot;, &quot;Tag2&quot;], &quot;MyCustomID&quot;);

//when the switch S1 status changes to ON, then turn on the HallLight
rules.when().item('S1').changed().toOn().then(sendOn().toItem('HallLight')).build(&quot;S1 Rule&quot;);

//when the HallLight colour changes pink, if the function fn returns true, then toggle the state of the OutsideLight
rules.when().item('HallLight').changed().to(&quot;300,100,100&quot;).if(fn).then().sendToggle().toItem('OutsideLight').build();

//and some rules which can be toggled by the items created in the 'gRules' Group:

//when the HallLight receives a command, send the same command to the KitchenLight
rules.when().item('HallLight').receivedCommand().then().sendIt().toItem('KitchenLight').build(&quot;Hall Light&quot;, &quot;&quot;);

//when the HallLight is updated to ON, make sure that BedroomLight1 is set to the same state as the BedroomLight2
rules.when().item('HallLight').receivedUpdate().then().copyState().fromItem('BedroomLight1').toItem('BedroomLight2').build();

</code></pre></article>
    </section>






    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Fri Feb 18 2022 18:14:58 GMT+0000 (Coordinated Universal Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>



</body>
</html>